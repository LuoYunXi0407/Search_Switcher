# 搜索切换（个人修改版）
## 好累，不想写中文版的 README 了

**精神状态错乱**

嗯这就是一个可以切换搜索引擎，但是保留搜索词的 Chrome 扩展就对了。

## 使用方法
嗯就是开发者模式「加载未打包的扩展程序」，然后钉在扩展栏就好了。需要用的时候就点击扩展按钮就好了。

![](https://github.com/user-attachments/assets/eeaef9f0-4ec8-42ab-8fe0-f2f2f3273965)

嗯就是如果能识别到搜索词，就可以切换其他搜索引擎；如果没有识别到，就会新标签页跳到主页。


## 配置搜索引擎
配置 `platform.json`。~~肉眼可得怎么改~~，如果实在不知道怎么改看英文 README 吧。

注意一下，如果搜索平台没有 `searchParam`，可以将其设为 `null`，注意是 `null` 不是 `"null"`。该搜索平台将会通过 `urlTemplate` 解析搜索词。

## 我为什么会选择修改这个扩展，而不是直接使用其他现成的扩展
类似于手机 via 浏览器更新的快捷搜索切换，我的需求是可以在输入搜索词之后单次切换搜索引擎并且不修改默认扩展引擎。但是目前在 Chrome 扩展商店存在的切换引擎的扩展，要么不符合我的需求（例如把扩展内建页面设为搜索引擎，在搜索之前修改默认搜索引擎），要么就是实现方式是在网页中加入侧边栏且有在线功能，要么就是界面太过于复古，总之就在 ChatGPT 的大力帮助下我对这个扩展改起来了。

而且我还会有一个额外的需求，就是 **可以在网页加载完成之前读取到当前地址**。毕竟用的 Chrome，我也不喜欢改成别的默认搜索引擎，所以我对这个扩展最大的修改期望就是：

假如某个时候并没有使用代理，在搜索后，其他插件都是在网页加载失败后才能切换搜索引擎的，但是我先改成在网页加载的过程中就能切换。

你可能会说，为什么不输入引擎简称（baidu.com/bing.com）然后按 tab 然后进行搜索，我会说这个方法我用过一段时间，嗯感觉打起来好累，嗯就这样。（精神状态混乱），而且最主要功能还是某个引擎看完了感觉没有看到很多想要的结果可以换，嗯

## 与原版的修改部分：

### 最重要的，可以在页面加载未完成的获取当前 Tab 的 URL
- 原本实现方式和其他插件都是使用 tab.url 的方式获取 URL 的，都只能在网页加载完毕之后或者 Google `ERR_CONNECTION_TIMED_OUT` 之后才能读取 URL，而不是网页正在加载的过程中就能获取 URL，所以我用到了 webNavigation 监听导航开始，然后存起来 URL 和 tabId，然后在切换到标签页的时候根据 tabID 来获取刚才保存的 URL
- 不过似乎标签页开久了 popup.js 就收不到 background.js 的通信了，不过无所谓了，如果通信不了的话就摆了，反正标签页这么久页面不超时大概也加载出来了，那就干脆在通信不了的时候获取 tab.url 吧

### 关于自定义引擎和编辑部分
- Google HK 和 Bing CN 的域名没办法被识别到，用起来很难受，但是如果添加自定义搜索引擎的话，由于自定义搜索引擎的按钮似乎大概率无法保存，且就算保存了也只保存 `urlTemplate` 不保存 `searchParam`，导致只能识别引擎倒是不能识别搜索词，所以切换到自定义引擎之后就无法再次换引擎了。
- 因此，针对 Google HK 和 Bing CN 的问题，我加了 `matchDomains` 和对应的识别代码。
- 反正自定义基本用不了，那我干脆把所有编辑操作（自定义/移除/删除/排序）给 Collapse 得了，也不在本地保存配置文件了，如果要编辑搜索引擎直接编辑 platform.json 好了
- 我也不知道原版的 `platform.json` 是从哪里读的（小声），就在扩展当前所在目录读得了
- 至于在当前标签页还是在新标签页打开的设置，因为涉及到设置的存取，我也把它 Collapse 掉了。后续会考虑在其他方法加入？例如允许在引擎右键选择「在新标签页中打开」、「在新标签页中后台打开」和「打开主页」？

### 移除加载在页面中的扩展按钮
- 不知道为什么有的时候能加载出来有的加载不出来，干脆注释掉得了（

### 移除原本自带的部分非搜索引擎平台
- 例如 Youtube、Bilibili、小红书、抖音、什么值得买、淘宝、京东、豆瓣，这些我个人认为不是严格意义上的搜索引擎，而且很少会出现在电脑中切换这些网页的存在，所以没有在默认的搜索引擎中。如果你需要用到的话，可以自行在 platform.json 中添加。

### 没有识别到搜索词的情况，改成了跳转主页
- 反正与其 alert 报个无法打开，不如打开主页好了（

### 关于没有 searchParam 采用优化的识别方式
- 原版中对于抖音这种没有 `searchParam` 的搜索是采用 `id === douyin` 来判断的，这样不具有普遍性。对此修改，以适配所有没有 searchParam 的搜索平台（若有）。


## 最后

祝大家生活愉快（精神状态错乱

---

以下是原作者的 README：

---


# 搜索切换

## 简介
搜索切换是一个Chrome浏览器扩展，允许用户在不同搜索平台之间轻松切换相同的搜索关键词。用户可以一键从当前搜索平台（如Google、百度、知乎等）跳转到另一个平台，无需重新输入搜索词。

## 主要功能

### 默认搜索平台支持
- Google
- Bing
- 百度
- 知乎
- YouTube
- 哔哩哔哩
- 小红书
- 抖音
- 淘宝
- 京东
- 豆瓣

### 核心功能
1. **一键切换搜索平台**：保留相同搜索词，轻松在不同平台间切换
2. **自定义搜索平台**：添加、编辑和删除自定义搜索平台
3. **平台排序**：通过拖拽调整平台显示顺序
4. **自定义图标**：为自定义平台上传专属图标
5. **悬浮入口**：可拖拽的浏览器边缘悬浮按钮，方便随时调用
6. **新标签页打开**：可选择在新标签页或当前标签页打开搜索结果
7. **平台编辑**：支持编辑和恢复所有平台，包括默认平台
8. **平台恢复**：支持恢复已删除的默认平台
9. **平滑动画**：切换开关和界面操作时有流畅的动画效果

## 使用说明

### 基本使用
1. 在任何支持的搜索网站上进行搜索
2. 点击扩展图标打开搜索切换面板
3. 当前搜索平台将显示在顶部，支持的其他平台列在下方
4. 点击任意平台图标，即可跳转到该平台并使用相同的搜索词

### 切换新标签页设置
1. 点击扩展面板底部的设置图标
2. 在弹出的设置菜单中，切换"在新标签页打开"选项
3. 开启后，点击平台将在新标签页打开搜索结果；关闭则在当前标签页打开

### 自定义平台
1. 点击"添加自定义平台"按钮
2. 填写平台名称和URL模板，URL模板中使用`{searchTerm}`作为搜索词占位符
3. 可选择上传平台图标
4. 点击"保存"添加自定义平台

### 编辑平台
1. 点击任意平台右上角的编辑图标
2. 修改平台信息
3. 点击"更新"保存更改，或点击"删除"移除该平台
4. 对于默认平台，删除操作将隐藏该平台，可通过设置菜单恢复

### 恢复默认平台
1. 点击扩展面板底部的设置图标
2. 在弹出的设置菜单中，点击"恢复已删除的默认平台"
3. 所有之前删除的默认平台将被恢复

### 平台排序
1. 长按平台左侧的拖动图标
2. 拖动平台到所需位置
3. 释放鼠标完成排序，排序结果会自动保存

### 悬浮入口使用
1. 在支持的搜索网站上，浏览器边缘会显示悬浮按钮
2. 可以通过拖拽调整悬浮按钮在浏览器边缘的位置
3. 点击悬浮按钮即可打开搜索切换面板
4. 悬浮按钮不会影响正常浏览，只在需要时出现

## 技术特点
- 使用现代JavaScript模块化设计，提高代码可维护性
- DOM缓存优化，提升性能
- 使用Chrome Storage API保存用户设置和自定义平台
- 支持拖拽排序功能
- 自动识别当前搜索平台和搜索词
- 悬浮入口使用CSS动画和拖拽功能，确保良好的用户体验
- 统一的错误处理机制，提高应用稳定性
- 优化的事件处理系统，防止内存泄漏
- 流畅的动画效果，增强用户交互体验
- CSS样式优化，支持暗黑模式和统一风格

## 隐私说明
- 所有数据仅存储在用户本地，不会上传到任何服务器
- 仅请求访问搜索网站的权限以识别搜索词和平台
- 不会收集任何用户的搜索历史或个人信息

## 兼容性
- 支持Chrome 88及以上版本
- 支持基于Chromium的浏览器（如Edge、Brave等）
- 适配深色模式，根据系统主题自动切换界面风格

## 问题反馈
如果您在使用过程中遇到任何问题或有功能建议，请通过Issues页面反馈。 